!function(){"use strict";class e extends Laya.Scene{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("Empty"),console.log("Start Load Scene")}}class t{static GetVectorPerp(e){return new Laya.Vector2(-e.y,e.x)}static VectorSign(e,t){return e.y*t.x>e.x*t.y?-1:1}static GetVecByRotationMatrix(e,t){let a=e.elements[0]*t.x+e.elements[3]*t.y+e.elements[6],s=e.elements[1]*t.x+e.elements[4]*t.y+e.elements[7];return new Laya.Vector2(a,s)}static GetAngleByRadius(e){return 180*e/Math.PI}static VectorTruncate(e,t){if(Laya.Vector2.scalarLength(e)>t){let a=new Laya.Vector2;Laya.Vector2.normalize(e,a);let s=new Laya.Vector2;return Laya.Vector2.scale(a,t,s),s}return e}static Subvector2(e,t){return new Laya.Vector2(t.x-e.x,t.y-e.y)}static GetvectVerb(e){return new Laya.Vector2(-e.x,-e.y)}static Addvector2(e,t){return new Laya.Vector2(t.x+e.x,t.y+e.y)}static GetweightAverage(e){let t=0;return e.forEach(e=>t+=e),t/e.length}}var a,s;!function(e){e[e.Slow=3]="Slow",e[e.Normal=2]="Normal",e[e.Fast=1]="Fast"}(a||(a={}));class i{constructor(e){this._entity=e,this._targetPos=this.entity.Pos,this._vSteeringForce=this.entity.Velocity||new Laya.Vector2(0,0)}get entity(){return this._entity}set entity(e){this._entity=e}get vSteeringForce(){return this._vSteeringForce}set vSteeringForce(e){this._vSteeringForce=e}get targetPos(){return this._targetPos}set targetPos(e){this._targetPos=e}Calculate(){return this.Arrive(this._targetPos,a.Fast)}seek(e){let a=new Laya.Vector2;return Laya.Vector2.normalize(t.Subvector2(this._entity.Pos,e),a),Laya.Vector2.scale(a,this._entity.MaxSpeed,a),t.Subvector2(this._entity.Velocity,a)}flee(e){if(Laya.Vector2.scalarLength(t.Subvector2(e,this._entity.Pos))>this._entity.BoundingRadius)return new Laya.Vector2(0,0);let a=new Laya.Vector2;return Laya.Vector2.normalize(t.Subvector2(e,this._entity.Pos),a),Laya.Vector2.scale(a,this._entity.MaxSpeed,a),t.Subvector2(this._entity.Velocity,a)}Arrive(e,a){let s=t.Subvector2(this._entity.Pos,e),i=Laya.Vector2.scalarLength(s);if(i>0){let e=i/(.3*a);e=Math.min(e,this.entity.MaxSpeed);let r=new Laya.Vector2,o=e/i;return console.log(" rate =====> ",o),Laya.Vector2.scale(s,o,r),t.Subvector2(this.entity.Velocity,r)}return new Laya.Vector2(0,0)}}!function(e){e[e.default_EntityType=-1]="default_EntityType",e[e.MoveEntity=0]="MoveEntity"}(s||(s={}));class r{constructor(e=r.NextValidId(),t=s.default_EntityType,a=0,i=new Laya.Vector2(0,0),o=new Laya.Vector2(0,0)){this.m_ID=e,this.m_dBoundingRadius=a,this.m_vPos=i,this.m_vScale=o,this.m_Type=t,this.m_Tag=!1}static NextValidId(){return this.NextID++}get Tag(){return this.m_Tag}set Tag(e){this.m_Tag=e}get ID(){return this.m_ID}set ID(e){this.m_ID=e}get Type(){return this.m_Type}set Type(e){this.m_Type=e}get Pos(){return this.m_vPos}set Pos(e){this.m_vPos=e}get Scale(){return this.m_vScale}set Scale(e){this.m_vScale=e}get BoundingRadius(){return this.m_dBoundingRadius}set BoundingRadius(e){this.m_dBoundingRadius=e}Update(e){}HandleMessage(e){return!1}}r.NextID=0;class o extends r{constructor(e,t,a,i,o,n,h,c,y){super(r.NextValidId(),s.MoveEntity,c,h,y),this.m_vVelocity=e,this.m_dMaxSpeed=t,this.m_vHeading=a,this.m_Mass=i,this.m_dMaxTurnRate=o,this.m_dMaxForce=n}get Velocity(){return this.m_vVelocity}set Velocity(e){this.m_vVelocity=e}get vHeading(){return this.m_vHeading}set vHeading(e){e.x*e.x+e.y*e.y-1>1e-6?console.error("请检查方向向量是否归一化"):(this.m_vHeading=e,this.m_vSide=t.GetVectorPerp(e))}get vSide(){return this.m_vSide}set vSide(e){this.m_vSide=e}get Mass(){return this.m_Mass}set Mass(e){this.m_Mass=e}get MaxSpeed(){return this.m_dMaxSpeed}set MaxSpeed(e){this.m_dMaxSpeed=e}get MaxForce(){return this.m_dMaxForce}set MaxForce(e){this.m_dMaxForce=e}get MaxTurnRate(){return this.m_dMaxTurnRate}set MaxTurnRate(e){this.m_dMaxTurnRate=e}RotationHeadingToFacePosition(e){let a=new Laya.Vector2(e.x-this.m_vHeading.x,e.y-this.m_vHeading.y),s=new Laya.Vector2;Laya.Vector2.normalize(a,s);let i=Math.acos(Laya.Vector2.dot(this.m_vHeading,a));if(i<1e-6)return!0;i>this.m_dMaxTurnRate&&(i=this.m_dMaxTurnRate);let r=Laya.Pool.getItem("Matrix3x3")||new Laya.Matrix3x3,o=r.clone(),n=t.VectorSign(a,this.m_vHeading)*i;return r.rotate(n,o),this.m_vVelocity=t.GetVecByRotationMatrix(o,this.m_vVelocity),this.m_vHeading=t.GetVecByRotationMatrix(o,this.m_vHeading),Laya.Pool.recover("Matrix3x3",r),this.m_vSide=t.GetVectorPerp(this.m_vHeading),!1}}class n extends o{constructor(e,t,a,s,r,o,n,h,c,y=0){super(s,n,new Laya.Vector2(Math.sin(a),-Math.cos(a)),r,h,o,t,y,new Laya.Vector2(c,c)),this.m_GameWold=e,this.m_vSmoothedHeading=new Laya.Vector2(0,0),this.m_deltaElapsed=0,this.m_SmoothingOn=!1,this.m_StreeBehaviors=new i(this),this.m_HeadingSmoother=[],this.m_HeadingSmoother.push(new Laya.Vector2(0,0))}get GameWold(){return this.m_GameWold}set GameWold(e){this.m_GameWold=e}get StreeBehaviors(){return this.m_StreeBehaviors}set StreeBehaviors(e){this.m_StreeBehaviors=e}get HeadingSmoother(){return this.m_HeadingSmoother}set HeadingSmoother(e){this.m_HeadingSmoother=e}get SmoothedHeading(){return this.m_vSmoothedHeading}set SmoothedHeading(e){this.m_vSmoothedHeading=e}get SmoothingOn(){return this.m_SmoothingOn}set SmoothingOn(e){this.m_SmoothingOn=e}get deltaElapsed(){return this.m_deltaElapsed}set deltaElapsed(e){this.m_deltaElapsed=e}Update(e){this.m_deltaElapsed=e;this.Pos;let a=this.m_StreeBehaviors.Calculate();console.log("Calculate ===> ",a);let s=new Laya.Vector2(a.x/this.Mass,a.y/this.Mass);if(this.Velocity=new Laya.Vector2(s.x*e+this.Velocity.x,s.y*e+this.Velocity.y),this.Velocity=t.VectorTruncate(this.Velocity,this.MaxSpeed),this.Pos=new Laya.Vector2(this.Velocity.x*e+this.Pos.x,this.Velocity.y*e+this.Pos.y),Laya.Vector2.scalarLength(this.Velocity)>1e-7){let e=new Laya.Vector2;Laya.Vector2.normalize(this.Velocity,e),this.vHeading=e}}}class h extends Laya.Script{onUpdate(){this.update(this.owner.timer.delta/1e3)}update(e){}}class c extends h{onAwake(){this.Vech_Sprite=this.owner.getChildByName("vche_Sprite1"),this.Mouse=this.owner.getChildByName("Vech_Mouse"),this._Vech=new n(null,new Laya.Vector2(100,0),0,new Laya.Vector2(0,0),1,10,400,400,1,200),this.Vech_Sprite.pivot(this.Vech_Sprite.width/2,this.Vech_Sprite.height/2),this.Mouse.pivot(this.Mouse.width/2,this.Mouse.height/2)}onEnable(){Laya.stage.on(Laya.Event.CLICK,this,this.onClick_)}onDisable(){Laya.stage.off(Laya.Event.CLICK,this,this.onClick_)}onClick_(e){this.Mouse.pos(e.stageX,e.stageY),this._Vech.StreeBehaviors.targetPos=new Laya.Vector2(e.stageX,e.stageY)}update(e){this._Vech.Update(e),this.Vech_Sprite.pos(this._Vech.Pos.x,this._Vech.Pos.y%Laya.stage.height);let a=t.GetAngleByRadius(Math.atan2(this._Vech.vHeading.y,this._Vech.vHeading.x));this.Vech_Sprite.rotation=a}}class y{constructor(){}static init(){var t=Laya.ClassUtils.regClass;t("Game/Empty_UI.ts",e),t("Game/VehcileTest.ts",c)}}y.width=1920,y.height=1080,y.scaleMode="fixedauto",y.screenMode="none",y.alignV="top",y.alignH="left",y.startScene="Empty.scene",y.sceneRoot="",y.debug=!1,y.stat=!1,y.physicsDebug=!1,y.exportSceneToJson=!0,y.init();new class{constructor(){window.Laya3D?Laya3D.init(y.width,y.height):Laya.init(y.width,y.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=y.scaleMode,Laya.stage.screenMode=y.screenMode,Laya.stage.alignV=y.alignV,Laya.stage.alignH=y.alignH,Laya.URL.exportSceneToJson=y.exportSceneToJson,(y.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),y.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),y.stat&&Laya.Stat.show(),Laya.alertGlobalError=!0,Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){y.startScene&&Laya.Scene.open(y.startScene)}}}();